-- liquibase formatted sql

-- changeset Administrator:1639480792885-1
CREATE TABLE BAD_FACTORY_FILES (SCHEMA_NAME VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, FULL_PATH VARCHAR(1000) NOT NULL, ERROR VARCHAR(1000) NULL, FIX_STATUS VARCHAR(1000) NULL, UPDATE_DATE timestamp DEFAULT NOW() NULL, CONSTRAINT PK_BAD_FACTORY_FILES PRIMARY KEY (FULL_PATH));

-- changeset Administrator:1639480792885-2
CREATE TABLE BATCH_LOAD_STATUS (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, DAG_RUN_ID VARCHAR(200) NOT NULL, BATCH_ID VARCHAR(200) NOT NULL, PROCESS_START_DATE timestamp NULL, PROCESS_END_DATE timestamp NULL, EXECUTION_IN_SEC BIGINT NULL, STATUS VARCHAR(50) NULL, LOAD_START_DATE timestamp NULL, LOAD_END_DATE timestamp NULL, INPUT_SQL_COMMAND VARCHAR(4000) NULL, INPUT_NUM_BATCHES BIGINT NULL, INPUT_NUM_FILES BIGINT NULL, INPUT_NUM_BYTES DECIMAL(26) NULL, INPUT_ROWS DECIMAL(26) NULL, OUTPUT_PATH VARCHAR(1000) NULL, OUTPUT_NUM_PARTITIONS BIGINT NULL, OUTPUT_NUM_PARTITIONS_INSERTED BIGINT NULL, OUTPUT_NUM_PARTITIONS_UPDATED BIGINT NULL, OUTPUT_NUM_FILES BIGINT NULL, OUTPUT_NUM_BYTES DECIMAL(26) NULL, OUTPUT_NUM_ROWS DECIMAL(26) NULL, HADOOP_ETL_LOAD_DATE timestamp NULL, ATLAS_VERSION BIGINT NULL, ANALYZE_STATUS VARCHAR(50) NULL, CONSTRAINT PK_BATCH_LOAD_STATUS PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE, DAG_RUN_ID, BATCH_ID));

-- changeset Administrator:1639480792885-3
CREATE TABLE CLUSTERS (CLUSTER_ID VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NULL, CLUSTER_FOR VARCHAR(100) NULL, MASTER_IP_ADD VARCHAR(100) NULL, LIVY_URL VARCHAR(1000) NULL, YARN_URL VARCHAR(1000) NULL, SPARK_URL VARCHAR(1000) NULL, GANGLIA_URL VARCHAR(1000) NULL, SPARK_SCRIPT_PATH VARCHAR(1000) NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_CLUSTERS PRIMARY KEY (CLUSTER_ID));

-- changeset Administrator:1639480792885-4
CREATE TABLE COLUMN_METADATA (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, METADATA_VERSION INT NOT NULL, SRC_COLUMN_NAME VARCHAR(100) NOT NULL, SRC_COLUMN_TYPE VARCHAR(100) NULL, SRC_DATA_TYPE VARCHAR(50) NULL, SRC_COLUMN_NUM INT NULL, INTERNAL_COLUMN BIT(1) NULL, DERIVED_COLUMN_FORMULA VARCHAR(4000) NULL, LOOKUP_TABLE_ALIAS VARCHAR(100) NULL, PREDEFINED_VALUE VARCHAR(50) NULL, TARGET_COLUMN_NAME VARCHAR(100) NOT NULL, TARGET_DATA_TYPE VARCHAR(50) NULL, TARGET_COLUMN_ID INT NULL, TARGET_DEFAULT_VALUE VARCHAR(100) NULL, IS_PKEY_COLUMN BIT(1) DEFAULT 0 NULL, IS_PARTITION_COLUMN BIT(1) DEFAULT 0 NULL, IS_UPDATE_DATE_COLUMN BIT(1) DEFAULT 0 NULL, IS_DATATYPE_CHANGED BIT(1) DEFAULT 0 NULL, IS_RENAMED BIT(1) NULL, IS_NEW BIT(1) NULL, APPLY_TRANSFORM VARCHAR(1000) NULL, MASK_REGEX_FIND VARCHAR(1000) NULL, MASK_REGEX_SUBST VARCHAR(100) NULL, HASH_ALGO VARCHAR(100) NULL, IS_COLUMN_ENCRYPT VARCHAR(100) NULL, PII_PROTECT_POLICY INT NULL, UPDATE_DATE timestamp NULL, UPDATED_BY VARCHAR(100) NULL, CONSTRAINT PK_COLUMN_METADATA PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE, METADATA_VERSION, TARGET_COLUMN_NAME));

-- changeset Administrator:1639480792885-5
CREATE TABLE COLUMN_METADATA_LOOKUP (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, METADATA_VERSION INT NOT NULL, LOOKUP_SCHEMA_NAME VARCHAR(100) NOT NULL, LOOKUP_TABLE_NAME VARCHAR(100) NOT NULL, LOOKUP_ENV_NAME VARCHAR(100) NOT NULL, LOOKUP_TABLE_ALIAS VARCHAR(100) NOT NULL, COLUMN_NAME_PREFIX VARCHAR(15) NULL, LOOKUP_JOIN_TYPE VARCHAR(100) NOT NULL, LOOKUP_JOIN_KEYS VARCHAR(1000) NOT NULL, UPDATE_DATE timestamp NULL, UPDATED_BY VARCHAR(100) NULL, CONSTRAINT PK_COLUMN_METADATA_LOOKUP PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE, METADATA_VERSION, LOOKUP_TABLE_ALIAS));

-- changeset Administrator:1639480792885-6
CREATE TABLE COLUMN_METADATA_VERSION (SCHEMA_NAME VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, METADATA_VERSION INT NOT NULL, START_DATE timestamp NOT NULL, END_DATE timestamp NULL, STATUS VARCHAR(50) NOT NULL, INSERT_DATE timestamp NOT NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_COLUMN_METADATA_VERSION PRIMARY KEY (SCHEMA_NAME, TABLE_NAME, METADATA_VERSION));

-- changeset Administrator:1639480792885-7
CREATE TABLE CUSTOM_LOAD_PARTITION (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, PARTITION_TYPE VARCHAR(1000) NULL, PARTITION_COLUMN VARCHAR(1000) NULL, UPDATE_DATE timestamp DEFAULT NOW() NULL, UPDATED_BY VARCHAR(100) NULL, CONSTRAINT PK_CUSTOM_LOAD_PARTITION PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE));

-- changeset Administrator:1639480792885-8
CREATE TABLE CUSTOM_LOAD_TABLE (SCHEMA_NAME VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, LOAD_STRATEGY VARCHAR(100) NULL, FACT_SCHEMA_NAME VARCHAR(100) NOT NULL, FACT_TABLE_NAME VARCHAR(100) NOT NULL, QUERY TEXT NOT NULL, MAX_ATLAS_VER INT DEFAULT 0 NULL, PARALLELISM INT DEFAULT 1 NULL, STATUS VARCHAR(100) NULL, UPDATE_DATE timestamp DEFAULT NOW() NULL, GROUPSIZE BIGINT NOT NULL, CONSTRAINT PK_CUSTOM_LOAD_TABLE PRIMARY KEY (SCHEMA_NAME, TABLE_NAME));

-- changeset Administrator:1639480792885-9
CREATE TABLE DAG_GENERATOR_QUEUE (ID INT AUTO_INCREMENT NOT NULL, SCHEMA_NAME VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, STATUS VARCHAR(100) NULL, START_TIME timestamp NULL, END_TIME timestamp NULL, UPDATE_DATE timestamp DEFAULT NOW() NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_DAG_GENERATOR_QUEUE PRIMARY KEY (ID));

-- changeset Administrator:1639480792885-10
CREATE TABLE DB_ENDPOINTS (DB_ID VARCHAR(100) NOT NULL, HOST VARCHAR(200) NOT NULL, DB_NAME VARCHAR(100) NOT NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_DB_ENDPOINTS PRIMARY KEY (DB_ID));

-- changeset Administrator:1639480792885-11
CREATE TABLE DEFAULT_SETTING (SETTING_KEY VARCHAR(100) NOT NULL, SETTING_VALUE VARCHAR(1000) NOT NULL, CONSTRAINT PK_DEFAULT_SETTING PRIMARY KEY (SETTING_KEY));

-- changeset Administrator:1639480792885-12
CREATE TABLE EMAIL_ALERTS (EMAIL_GROUP VARCHAR(500) NOT NULL, EMAIL_ADDRESSES VARCHAR(10000) NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_EMAIL_ALERTS PRIMARY KEY (EMAIL_GROUP), UNIQUE (EMAIL_GROUP));

-- changeset Administrator:1639480792885-13
CREATE TABLE FILE_HEADER_HASH (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, HEADER_HASH VARCHAR(100) NOT NULL, HEADER_COLUMNS VARCHAR(8000) NULL, STATUS VARCHAR(50) NULL, INSERT_DATE timestamp NULL, UPDATE_DATE timestamp NULL, UPDATED_BY VARCHAR(100) NULL, HAS_DIM_COLUMNS BIT(1) DEFAULT 0 NULL, COL_METADATA_VERSION INT NULL, DQ_METADATA_VERSION INT NULL, CONSTRAINT PK_FILE_HEADER_HASH PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE, HEADER_HASH));

-- changeset Administrator:1639480792885-14
CREATE TABLE PII_PROTECT (ID VARCHAR(50) NULL, KMS_SALT_SYMM_KEY VARCHAR(50) NULL, SALT_ENCRYPTION_ALGO VARCHAR(50) NULL, KMS_ENCRYPT_ASYMM_KEY VARCHAR(50) NULL, ENCRYPT_ENCRYPTION_ALGO VARCHAR(50) NULL, SECRET_NAME VARCHAR(50) NULL) COMMENT='PII_PROTECT';
ALTER TABLE PII_PROTECT COMMENT = 'PII_PROTECT';

-- changeset Administrator:1639480792885-15
CREATE TABLE RAW_FILES (BATCH_ID INT NULL, MANIFEST_FILE_PATH VARCHAR(200) NULL, BUCKET_NAME VARCHAR(200) NOT NULL, OBJECT_NAME VARCHAR(1000) NOT NULL, HEADER_HASH VARCHAR(100) NULL, INSERT_DATE timestamp DEFAULT NOW() NULL, SOURCE_SYSTEM VARCHAR(100) NULL, TABLE_NAME VARCHAR(100) NULL, ENV_NAME VARCHAR(100) NULL, FILE_TYPE VARCHAR(100) NULL, DELIMITER VARCHAR(100) NULL, HAS_HEADER VARCHAR(100) NULL, PII_PRC_DATE timestamp NULL COMMENT 'Null if PII processing is not complete for this file.', PII_PRC_PATH VARCHAR(1000) NULL, PII_PRC_BUCKET_NAME VARCHAR(200) NULL, PII_PRC_OBJECT_NAME VARCHAR(1000) NULL, PROCESSED_DATE timestamp NULL, DAG_RUN_ID VARCHAR(200) NULL, CONSTRAINT PK_RAW_FILES PRIMARY KEY (BUCKET_NAME, OBJECT_NAME));
ALTER TABLE RAW_FILES MODIFY COLUMN PII_PRC_DATE timestamp COMMENT 'Null if PII processing is not complete for this file.';

-- changeset Administrator:1639480792885-16
CREATE TABLE SPARK_CONFIG (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(10) NOT NULL, SPARK_CONF VARCHAR(1000) NOT NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_SPARK_CONFIG PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE));

-- changeset Administrator:1639480792885-17
CREATE TABLE SPARK_CONFIGS (SPARK_ID VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(10) NOT NULL, SPARK_CONF VARCHAR(1000) NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_SPARK_CONFIGS PRIMARY KEY (SPARK_ID));

-- changeset Administrator:1639480792885-18
CREATE TABLE TABLE_LOAD_CONTROL (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, TARGET_SCHEMA_NAME VARCHAR(100) NULL, TARGET_TABLE_NAME VARCHAR(100) NULL, FACT_SCHEMA_NAME VARCHAR(100) NULL, FACT_TABLE_NAME VARCHAR(100) NULL, FACT_ENV_NAME VARCHAR(100) NULL, EMAIL_ALERTS VARCHAR(1) NULL, EMAIL_GROUP VARCHAR(500) NULL, TABLE_SOURCE VARCHAR(50) NULL, LOAD_STRATEGY VARCHAR(50) NULL, RAW_FACTORY_PATH VARCHAR(1000) NULL, RAW_FACTORY_MAX_LANDING_DATE timestamp DEFAULT '1990-01-01 00:00:00' NULL, RAW_FACTORY_SYNC_STATUS VARCHAR(45) DEFAULT 'HOLD' NULL, RAW_FACTORY_RETENTION_STRATEGY VARCHAR(50) NULL, RAW_FACTORY_RETENTION_DAYS INT NULL, DB_ID VARCHAR(100) NULL, DB_SCHEMA VARCHAR(100) NULL, DB_TABLE VARCHAR(100) NULL, DB_TABLE_PK_COLUMNS VARCHAR(1000) NULL, DB_TABLE_UPDATE_DATE_COLUMN VARCHAR(100) NULL, CHECK_INDEX_EXIST BIT(1) NULL, T1_PATH VARCHAR(1000) NULL, T1_RETENTION_STRATEGY VARCHAR(50) NULL, T1_RETENTION_DAYS INT NULL, T2_T3_RETENTION_STRATEGY VARCHAR(50) NULL, T2_T3_RETENTION_DAYS INT NULL, ETL_STATUS VARCHAR(50) NULL, ETL_STATUS_REASON VARCHAR(1000) NULL, DAG_SCHEDULE_INTERVAL VARCHAR(1000) NULL, ETL_DAG_NAME VARCHAR(200) NULL, ETL_DAG_RUN_ID VARCHAR(200) NULL, ETL_DAG_RUN_URL VARCHAR(200) NULL, ETL_PROCESS_START_DATE timestamp NULL, ETL_PROCESS_END_DATE timestamp NULL, ETL_EXECUTION_STATUS VARCHAR(50) NULL, ETL_PROCESS VARCHAR(50) NULL, T1_STATUS VARCHAR(50) NULL, T1_BUCKET VARCHAR(1000) NULL, T1_DATABASE VARCHAR(1000) NULL, T1_BATCH_IN_DAYS DECIMAL(10, 2) NULL, T1_MAX_TABLE_END_DATE timestamp DEFAULT '2037-01-01 00:00:00' NULL, T1_MAX_LOAD_END_DATE timestamp NULL, T1_CLUSTER_ID VARCHAR(200) NULL, T1_LIVY_BATCH_ID VARCHAR(100) NULL, T1_SPARK_CONFIG_ID VARCHAR(100) NULL, T1_SPARK_APP_ID VARCHAR(200) NULL, T1_SPARK_UI_URL VARCHAR(1000) NULL, T1_SPARK_LOG_URL VARCHAR(1000) NULL, T1_PROCESS_START_DATE timestamp NULL, T1_PROCESS_END_DATE timestamp NULL, T1_EXECUTION_STATUS VARCHAR(50) NULL, T1_ERROR VARCHAR(1000) NULL, T1_ERROR_TRACE TEXT NULL, T1_S3_CLEANUP_STATUS VARCHAR(45) DEFAULT 'HOLD' NULL, T2_STATUS VARCHAR(50) NULL, T2_BUCKET VARCHAR(1000) NULL, T2_DATABASE VARCHAR(1000) NULL, T2_TABLE_TYPE VARCHAR(100) NULL, T2_HUDI_MIN_COMMITS INT NULL, T2_HUDI_MAX_COMMITS INT NULL, T2_HUDI_INSERT_PARALLELISM INT NULL, T2_HUDI_UPSERT_PARALLELISM INT NULL, T2_INSERT_DIR_BATCH_SIZE INT NULL, T2_INSERT_BATCH_FILE_SIZE_GB INT DEFAULT 50 NULL, T2_PARTITION_JOB_TYPE VARCHAR(50) NULL, T2_MAX_TABLE_END_DATE timestamp DEFAULT '2037-01-01 00:00:00' NULL, T2_MAX_LOAD_END_DATE timestamp NULL, T1_BROADCAST BIT(1) DEFAULT 1 NULL, T2_MAX_ATLAS_VERSION VARCHAR(50) NULL, T2_CLUSTER_ID VARCHAR(200) NULL, T2_LIVY_BATCH_ID VARCHAR(100) NULL, T2_SPARK_CONFIG_ID VARCHAR(100) NULL, T2_SPARK_APP_ID VARCHAR(200) NULL, T2_SPARK_UI_URL VARCHAR(1000) NULL, T2_SPARK_LOG_URL VARCHAR(1000) NULL, T2_PROCESS_START_DATE timestamp NULL, T2_PROCESS_END_DATE timestamp NULL, T2_EXECUTION_STATUS VARCHAR(50) NULL, T2_ERROR VARCHAR(1000) NULL, T2_ERROR_TRACE TEXT NULL, T2_S3_CLEANUP_STATUS VARCHAR(45) DEFAULT 'HOLD' NULL, T3_STATUS VARCHAR(50) NULL, T3_BUCKET VARCHAR(1000) NULL, T3_DATABASE VARCHAR(1000) NULL, T3_TABLE_TYPE VARCHAR(100) NULL, T3_FORMAT VARCHAR(100) NULL, T3_CLUSTER_ID VARCHAR(200) NULL, T3_LIVY_BATCH_ID VARCHAR(100) NULL, T3_SPARK_CONFIG_ID VARCHAR(100) NULL, T3_SPARK_APP_ID VARCHAR(200) NULL, T3_SPARK_UI_URL VARCHAR(1000) NULL, T3_SPARK_LOG_URL VARCHAR(1000) NULL, T3_PROCESS_START_DATE timestamp NULL, T3_PROCESS_END_DATE timestamp NULL, T3_EXECUTION_STATUS VARCHAR(50) NULL, T3_ERROR VARCHAR(1000) NULL, T3_ERROR_TRACE TEXT NULL, ANALYZE_STATUS VARCHAR(50) NULL, ANALYZE_EXECUTION_DAYS INT NULL, ANALYZE_LAST_SUCCESS_DATE timestamp NULL, ANALYZE_PROCESS_START_DATE timestamp NULL, ANALYZE_PROCESS_END_DATE timestamp NULL, ANALYZE_EXECUTION_STATUS VARCHAR(50) NULL, ANALYZE_ERROR VARCHAR(1000) NULL, ANALYZE_ERROR_TRACE TEXT NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, DAG_AVAILABLE_STATUS VARCHAR(15) NULL, RAW_FACTORY_FILES_ARCHIVAL_TRACE TEXT NULL COMMENT 'Oversight of lifecycle policy settings', T2_T3_PURGE_TRACE TEXT NULL COMMENT 'Oversight of T2 purging failures', CONSTRAINT PK_TABLE_LOAD_CONTROL PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME));
ALTER TABLE TABLE_LOAD_CONTROL MODIFY COLUMN RAW_FACTORY_FILES_ARCHIVAL_TRACE TEXT COMMENT 'Oversight of lifecycle policy settings';
ALTER TABLE TABLE_LOAD_CONTROL MODIFY COLUMN T2_T3_PURGE_TRACE TEXT COMMENT 'Oversight of T2 purging failures';

-- changeset Administrator:1639480792885-19
CREATE TABLE TABLE_LOAD_SQL (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, SQL_TEXT TEXT NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_TABLE_LOAD_SQL PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE));

-- changeset Administrator:1639480792885-20
CREATE TABLE TABLE_LOAD_STATUS (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, DAG_NAME VARCHAR(200) NOT NULL, DAG_RUN_ID VARCHAR(200) NOT NULL, DAG_RUN_URL VARCHAR(200) NULL, PROCESS_START_DATE timestamp NULL, PROCESS_END_DATE timestamp NULL, EXECUTION_IN_SEC BIGINT NULL, CLUSTER_ID VARCHAR(200) NULL, LIVY_BATCH_ID VARCHAR(100) NULL, SPARK_APP_ID VARCHAR(200) NULL, SPARK_UI_URL VARCHAR(1000) NULL, SPARK_LOG_URL VARCHAR(1000) NULL, STATUS VARCHAR(50) NULL, SUCCESS_ATTEMPT_NO INT NULL, ERROR VARCHAR(1000) NULL, ERROR_TRACE TEXT NULL, DATA_SOURCE VARCHAR(50) NULL, SOURCE_PATH VARCHAR(1000) NULL, DB_ID VARCHAR(100) NULL, DB_SCHEMA VARCHAR(100) NULL, DB_TABLE VARCHAR(100) NULL, DB_TABLE_PK_COLUMNS VARCHAR(1000) NULL, DB_TABLE_UPDATE_DATE_COLUMN VARCHAR(100) NULL, LOAD_START_DATE timestamp NULL, LOAD_END_DATE timestamp NULL, PARTITION_VALUES VARCHAR(1000) NULL, CONSTRAINT PK_TABLE_LOAD_STATUS PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE, DAG_RUN_ID));

-- changeset Administrator:1639480792885-21
CREATE TABLE TABLE_QUALITY_CONTROL (SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, DQ_STATUS VARCHAR(50) NULL, DQ_STATUS_REASON VARCHAR(1000) NULL, T1_STATUS VARCHAR(50) NULL, T1_CLUSTER_ID VARCHAR(200) NULL, T1_SPARK_CONFIG_ID VARCHAR(100) NULL, T2_STATUS VARCHAR(50) NULL, T2_CLUSTER_ID VARCHAR(200) NULL, T2_SPARK_CONFIG_ID VARCHAR(100) NULL, T3_STATUS VARCHAR(50) NULL, T3_CLUSTER_ID VARCHAR(200) NULL, T3_SPARK_CONFIG_ID VARCHAR(100) NULL, ETL_DAG_NAME VARCHAR(200) NULL, ETL_DAG_RUN_ID VARCHAR(200) NULL, ETL_DAG_RUN_URL VARCHAR(200) NULL, ETL_PROCESS_START_DATE timestamp NULL, ETL_PROCESS_END_DATE timestamp NULL, T1_LIVY_BATCH_ID VARCHAR(100) NULL, T1_SPARK_APP_ID VARCHAR(200) NULL, T1_SPARK_UI_URL VARCHAR(1000) NULL, T1_SPARK_LOG_URL VARCHAR(1000) NULL, T1_PROCESS_START_DATE timestamp NULL, T1_PROCESS_END_DATE timestamp NULL, T1_EXECUTION_STATUS VARCHAR(50) NULL, T1_ERROR VARCHAR(1000) NULL, T1_ERROR_TRACE TEXT NULL, T2_LIVY_BATCH_ID VARCHAR(100) NULL, T2_SPARK_APP_ID VARCHAR(200) NULL, T2_SPARK_UI_URL VARCHAR(1000) NULL, T2_SPARK_LOG_URL VARCHAR(1000) NULL, T2_PROCESS_START_DATE timestamp NULL, T2_PROCESS_END_DATE timestamp NULL, T2_EXECUTION_STATUS VARCHAR(50) NULL, T2_ERROR VARCHAR(1000) NULL, T2_ERROR_TRACE TEXT NULL, T3_LIVY_BATCH_ID VARCHAR(100) NULL, T3_SPARK_APP_ID VARCHAR(200) NULL, T3_SPARK_UI_URL VARCHAR(1000) NULL, T3_SPARK_LOG_URL VARCHAR(1000) NULL, T3_PROCESS_START_DATE timestamp NULL, T3_PROCESS_END_DATE timestamp NULL, T3_EXECUTION_STATUS VARCHAR(50) NULL, T3_ERROR VARCHAR(1000) NULL, T3_ERROR_TRACE TEXT NULL, UPDATE_DATE timestamp NOT NULL, UPDATED_BY VARCHAR(100) NOT NULL, CONSTRAINT PK_TABLE_QUALITY_CONTROL PRIMARY KEY (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME));

-- changeset Administrator:1639480792885-22
CREATE TABLE TABLE_QUALITY_METRIC (METRIC_ID INT AUTO_INCREMENT NOT NULL, DAG_RUN_ID VARCHAR(200) NULL, FILE VARCHAR(1000) NULL, SOURCE_SYSTEM VARCHAR(100) NULL, TABLE_NAME VARCHAR(100) NULL, ENV_NAME VARCHAR(100) NULL, LOAD_TYPE VARCHAR(100) NULL, METADATA_VERSION VARCHAR(100) NULL, DQ_TYPE VARCHAR(100) NULL, ENTITY VARCHAR(100) NULL, INSTANCE VARCHAR(200) NULL, NAME VARCHAR(100) NULL, VALUE VARCHAR(100) NULL, `CHECK` VARCHAR(100) NULL, CHECK_LEVEL VARCHAR(100) NULL, CHECK_STATUS VARCHAR(100) NULL, `CONSTRAINT` VARCHAR(200) NULL, CONSTRAINT_STATUS VARCHAR(100) NULL, CONSTRAINT_MESSAGE VARCHAR(1000) NULL, CONSTRAINT PK_TABLE_QUALITY_METRIC PRIMARY KEY (METRIC_ID));

-- changeset Administrator:1639480792885-23
CREATE TABLE TABLE_QUALITY_RULE (RULE_ID INT AUTO_INCREMENT NOT NULL, SOURCE_SYSTEM VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, ENV_NAME VARCHAR(100) NOT NULL, LOAD_TYPE VARCHAR(100) NOT NULL, METADATA_VERSION VARCHAR(100) NOT NULL, DQ_TYPE VARCHAR(100) NOT NULL, COLUMN_NAME VARCHAR(100) NOT NULL, DQ_RULE VARCHAR(100) NOT NULL, ARGS_DICT VARCHAR(100) NULL, UPDATE_DATE timestamp NULL, UPDATED_BY VARCHAR(100) NULL, CONSTRAINT PK_TABLE_QUALITY_RULE PRIMARY KEY (RULE_ID));

-- changeset Administrator:1639480792885-24
CREATE TABLE TABLE_T1_MAX_DATE (TABLE_NAME VARCHAR(100) NOT NULL, T1_MAX_DATE VARCHAR(45) NULL, CONSTRAINT PK_TABLE_T1_MAX_DATE PRIMARY KEY (TABLE_NAME));

-- changeset Administrator:1639480792885-25
CREATE TABLE USERS (ID INT AUTO_INCREMENT NOT NULL, USER_NAME VARCHAR(100) NULL, PASSWORD VARCHAR(100) NULL, EMAIL_ID VARCHAR(100) NULL, FULL_NAME VARCHAR(100) NULL, `ROLE` INT NULL, PROFILE_PIC LONGTEXT NULL, PHONE INT NULL, DEPARTMENT VARCHAR(100) NULL, UPDATE_DATE timestamp NULL, UPDATED_BY VARCHAR(100) NULL, CONSTRAINT PK_USERS PRIMARY KEY (ID), UNIQUE (USER_NAME), UNIQUE (EMAIL_ID));

-- changeset Administrator:1639480792885-26
CREATE TABLE USER_PERMISSIONS (ID INT AUTO_INCREMENT NOT NULL, NAME VARCHAR(100) NOT NULL, PARENT INT NOT NULL, TITLE VARCHAR(100) NOT NULL, UPDATE_DATE timestamp NULL, UPDATED_BY VARCHAR(100) NULL, CONSTRAINT PK_USER_PERMISSIONS PRIMARY KEY (ID));

-- changeset Administrator:1639480792885-27
CREATE TABLE USER_ROLES (ID INT AUTO_INCREMENT NOT NULL, TITLE VARCHAR(100) NOT NULL, PERMISSIONS VARCHAR(1000) NULL, ISCOREROLE BIT(1) NULL, UPDATE_DATE timestamp NULL, UPDATED_BY VARCHAR(100) NULL, CONSTRAINT PK_USER_ROLES PRIMARY KEY (ID));

-- changeset Administrator:1639480792885-28
CREATE TABLE VALIDATION_STATS (SCHEMA_NAME VARCHAR(100) NOT NULL, TABLE_NAME VARCHAR(100) NOT NULL, `PARTITION` VARCHAR(100) NOT NULL, EDW_CNT INT NOT NULL, PRESTO_CNT INT NOT NULL, VALIDATION_DT timestamp NOT NULL);

-- changeset Administrator:1639480792885-29
ALTER TABLE TABLE_QUALITY_RULE ADD CONSTRAINT SELECT_BY_TABLE UNIQUE (SOURCE_SYSTEM, TABLE_NAME, ENV_NAME, LOAD_TYPE, METADATA_VERSION, DQ_TYPE, COLUMN_NAME, DQ_RULE);

-- changeset ammar:202112141301-1
CREATE TABLE LIQUIBASE_EX (id int primary key, name varchar(50) not null);
-- rollback DROP TABLE LIQUIBASE_EX;
